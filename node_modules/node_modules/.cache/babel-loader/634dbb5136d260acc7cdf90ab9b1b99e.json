{"ast":null,"code":"var _jsxFileName = \"F:\\\\React\\\\dog-classifier\\\\src\\\\App.js\";\nimport * as tf from '@tensorflow/tfjs';\nimport React, { useReducer, useState, useRef } from 'react';\nimport './App.css';\nimport * as mobilenet from '@tensorflow-models/mobilenet';\nconst stateMachine = {\n  initial: 'initial',\n  states: {\n    initial: {\n      on: {\n        next: 'loadingModel'\n      }\n    },\n    loadingModel: {\n      on: {\n        next: 'awaitingUpload'\n      }\n    },\n    awaitingUpload: {\n      on: {\n        next: 'ready'\n      }\n    },\n    ready: {\n      on: {\n        next: 'classifying'\n      },\n      showImage: true\n    },\n    classifying: {\n      on: {\n        next: 'complete'\n      }\n    },\n    complete: {\n      on: {\n        next: 'awaitingUpload'\n      },\n      showImage: true\n    }\n  }\n};\n\nconst reducer = (currentState, event) => stateMachine.states[currentState].on[event] || stateMachine.initial;\n\nconst formatResult = ({\n  className,\n  probability\n}) => /*#__PURE__*/React.createElement(\"li\", {\n  key: className,\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 20,\n    columnNumber: 3\n  }\n}, `${className}: %${(probability * 100).toFixed(2)}`);\n\nfunction App() {\n  tf.setBackend(\"cpu\");\n  const [state, dispatch] = useReducer(reducer, stateMachine.initial);\n  const [model, setModel] = useState(null);\n  const [imageURL, setImageUrl] = useState(null);\n  const [results, setResults] = useState([]);\n  const inputRef = useRef();\n  const imageRef = useRef();\n\n  const next = () => dispatch('next');\n\n  const loadModel = async () => {\n    console.log(\"model loaded\");\n    next();\n    const mobilenetModel = await mobilenet.load();\n    setModel(mobilenetModel);\n    next();\n  };\n\n  const handleUpload = e => {\n    console.log(\"running\");\n    const {\n      files\n    } = e.target;\n\n    if (files.length > 0) {\n      const url = URL.createObjectURL(files[0]);\n      setImageUrl(url);\n      next();\n    }\n  };\n\n  const identify = async () => {\n    next();\n    const results = await model.classify(imageRef.current);\n    console.log({\n      results\n    });\n    setResults(results);\n    next();\n  };\n\n  const buttonProps = {\n    initial: {\n      text: 'Load Model',\n      action: loadModel\n    },\n    loadingModel: {\n      text: 'Loading Model...',\n      action: () => {}\n    },\n    awaitingUpload: {\n      text: 'Upload Photo',\n      action: () => inputRef.current.click()\n    },\n    ready: {\n      text: 'Identify',\n      action: identify\n    },\n    classifying: {\n      text: 'Identifying',\n      action: () => {}\n    },\n    complete: {\n      text: 'Reset',\n      action: () => {}\n    }\n  };\n  const {\n    showImage = false,\n    showResults = false\n  } = stateMachine.states[state];\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 5\n    }\n  }, showImage && /*#__PURE__*/React.createElement(\"img\", {\n    src: imageURL,\n    alt: \"upload-preview\",\n    ref: imageRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 21\n    }\n  }), showResults && /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 24\n    }\n  }, results.map(formatResult)), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"file\",\n    accept: \"image/*\",\n    capture: \"camera\",\n    onChange: handleUpload,\n    ref: inputRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: buttonProps[state].action,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }\n  }, \" \", buttonProps[state].text));\n}\n\nexport default App;","map":{"version":3,"sources":["F:/React/dog-classifier/src/App.js"],"names":["tf","React","useReducer","useState","useRef","mobilenet","stateMachine","initial","states","on","next","loadingModel","awaitingUpload","ready","showImage","classifying","complete","reducer","currentState","event","formatResult","className","probability","toFixed","App","setBackend","state","dispatch","model","setModel","imageURL","setImageUrl","results","setResults","inputRef","imageRef","loadModel","console","log","mobilenetModel","load","handleUpload","e","files","target","length","url","URL","createObjectURL","identify","classify","current","buttonProps","text","action","click","showResults","map"],"mappings":"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","sourcesContent":["import * as tf from '@tensorflow/tfjs';\nimport React, { useReducer,useState, useRef } from 'react';\nimport './App.css';\nimport * as mobilenet from '@tensorflow-models/mobilenet';\n\nconst stateMachine = {\n  initial :'initial',\n  states : { \n  initial : { on : {next : 'loadingModel'}},\n  loadingModel: { on : {next: 'awaitingUpload'}},\n  awaitingUpload:{ on : {next: 'ready'}},\n  ready : { on : {next: 'classifying'},showImage: true},\n  classifying: { on : {next: 'complete'}},\n  complete : { on : {next: 'awaitingUpload'}, showImage: true }\n}\n}\nconst reducer = (currentState, event) => stateMachine.states[currentState].on[event] || stateMachine.initial;\n\nconst formatResult = ({ className, probability }) => (\n  <li key={className}>\n    {`${className}: %${(probability * 100).toFixed(2)}`}\n  </li>\n);\n\nfunction App() {\n  tf.setBackend(\"cpu\");\n  const [state,dispatch] = useReducer(reducer,stateMachine.initial);\n  const [model,setModel] = useState(null);\n  const [imageURL,setImageUrl] = useState(null);\n  const [results,setResults] = useState([]);\n  \n  const inputRef = useRef();\n  const imageRef = useRef();\n\n  const next = () => dispatch('next')\n\n  \n\n  const loadModel = async () => {\n    console.log(\"model loaded\")\n    next();\n    const mobilenetModel = await mobilenet.load();\n    setModel(mobilenetModel);\n    next();\n\n  }\n  const handleUpload = e => {\n    console.log(\"running\")\n    const { files } = e.target;\n    if (files.length > 0){\n      const url = URL.createObjectURL(files[0]);\n      setImageUrl(url);\n      next();\n    }\n  }\n\n  const identify = async () => {\n    next();\n    const results = await model.classify(imageRef.current);\n    console.log({results});\n    setResults(results);\n    next();\n  }\n  const buttonProps = {\n    initial : { text : 'Load Model', action: loadModel },\n    loadingModel : { text : 'Loading Model...', action: () => { } },\n    awaitingUpload : {  text : 'Upload Photo', action: () => inputRef.current.click() },\n    ready : {  text : 'Identify', action: identify },\n    classifying : {  text : 'Identifying', action: () => {} },\n    complete : {  text : 'Reset', action: () => {}}\n  }\n\n  const { showImage = false, showResults = false } = stateMachine.states[state];\n  \n  return (\n    <div>\n      {showImage && <img  src={imageURL} alt=\"upload-preview\" ref={imageRef} /> }\n      { showResults && <ul>\n        {results.map(formatResult)}\n      </ul>}\n      <input type=\"file\" accept=\"image/*\" capture=\"camera\" onChange={handleUpload} ref={inputRef} />\n      <button onClick={buttonProps[state].action}> {buttonProps[state].text}</button>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}